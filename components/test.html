<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert Video to MP4</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
        }
        .video-container {
            width: 80%;
            max-width: 800px;
            text-align: center;
        }
        .loader {
            display: none;
            font-size: 20px;
            margin-top: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.0/dist/ffmpeg.min.js"></script>
</head>
<body>

    <div class="video-container">
        <h1>Convert Video to MP4</h1>
        <input type="file" id="fileInput" accept="video/*">
        <div class="loader">Processing video...</div>
        <video id="videoPlayer" width="640" height="480" controls style="display: none;">
            <source id="videoSource" type="video/mp4">
        </video>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoSource = document.getElementById('videoSource');
        const loader = document.querySelector('.loader');

        // Fonction pour convertir la vidéo en MP4 avec les codecs nécessaires
        async function convertVideoToMp4(inputFile) {
            // Charger la bibliothèque FFmpeg.js
            const { createFFmpeg, fetchFile } = FFmpeg;
            const ffmpeg = createFFmpeg({ log: true });
            await ffmpeg.load();

            // Écrire le fichier d'entrée dans la mémoire FFmpeg
            ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(inputFile));

            // Afficher les journaux de log de FFmpeg
            ffmpeg.setLogger(({ type, message }) => {
                console.log(`${type}: ${message}`);
            });

            // Lancer la commande de conversion
            try {
                await ffmpeg.run('-i', 'input.mp4', '-c:v', 'libx264', '-c:a', 'aac', 'output.mp4');
            } catch (error) {
                console.error('Erreur pendant la conversion:', error);
                throw new Error('Erreur pendant la conversion');
            }

            // Lire le fichier de sortie
            const data = ffmpeg.FS('readFile', 'output.mp4');

            // Créer une URL pour le fichier converti
            const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
            const videoURL = URL.createObjectURL(videoBlob);

            return videoURL;
        }

        // Gérer le changement de fichier
        fileInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            loader.style.display = 'block';
            videoPlayer.style.display = 'none';

            try {
                const mp4VideoURL = await convertVideoToMp4(file);
                videoSource.src = mp4VideoURL;
                videoPlayer.style.display = 'block';
                loader.style.display = 'none';
            } catch (error) {
                console.error('Erreur de conversion vidéo:', error);
                loader.textContent = 'Failed to process the video.';
            }
        });
    </script>

</body>
</html>
